import sys
import json

def main(clustersFilename):
    #print(1)
    with open(clustersFilename, "r") as f:
        clusters = json.loads(f.read())

    entries = json.loads(sys.stdin.read())
    #print(entries)
    counts = {}

    for entry in entries:
        desc = entry["desc"].lower()

        for cluster in clusters:
            if len(cluster) == 1:
                name = cluster[0]
                if name in desc:
                    entry["cluster"] = name
                    if name not in counts:
                        counts[name] = 0
                    counts[name] += 1
                    break
            elif len(cluster) == 2:
                primary, secondary = cluster
                if primary in desc:
                    if secondary in desc:
                        name = f"{primary}-and-{secondary}"
                    else:
                        name = f"{primary}-and-not-{secondary}"
                    entry["cluster"] = name
                    if name not in counts:
                        counts[name] = 0
                    counts[name] += 1
                    break
            else:
                raise ValueError("Bad cluster")

        if "cluster" not in entry:
            name = "else"
            entry["cluster"] = name
            if name not in counts:
                counts[name] = 0
            counts[name] += 1

    j = json.dumps(counts, indent=4, sort_keys=True)
    sys.stderr.write(f"{j}\n")

    e = json.dumps(entries, indent=4, sort_keys=True)
    print(e)

if __name__ == "__main__":
    #print(2)
    clustersFilename = sys.argv[1]
    main(clustersFilename)

#print(3)
