#!/usr/bin/env bash
#
# First, download and unzip allitems.csv.gz from https://cve.mitre.org/data/downloads/allitems.csv.gz
#
# This is the database of ~200k CVE's from 1999 to today.
#
# Then, run this script.
#
# Usage: ./gen-mutations.sh ~/Downloads/allitems.csv
#

ALLITEMS=$1

echo "Extracting only 2020 CVE's"

mkdir -p data
cat $ALLITEMS | grep "^CVE-2020" > data/cve-2020.csv

LINES_2020=`cat data/cve-2020.csv | wc -l `
echo "Created data/cve-2020.csv"
echo "$LINES_2020 CVE's"
echo

echo "Extracting CVE identifiers and descriptions into json."
echo "Also dropping CVE's we want to ignore, such as CVE's containing the string 'RESERVED'."
cat data/cve-2020.csv | python3 extract_id_desc.py > data/cve-2020.json
echo

echo "Clustering CVE's based upon, cluster/2020-clusters.json, which was pre-generated."
echo "clusterName to clusterSize map:"
cat data/cve-2020.json | python3 cluster.py cluster/2020-clusters.json > data/cve-2020-clustered.json
echo
