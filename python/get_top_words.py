import sys
import json

# cat rawdata/cve-2020-clustered.json | python3 get_top_words.py 100 > rawdata/cve-2020-clustered-top-100.json

class GetTopWords:

    def __init__(self, entries, numTopWords):
        self.entries = entries
        self.numTopWords = numTopWords

    def getTopWords(self):

        # clusterWordCount[clusterName][word] == count
        clusterWordCount = {}
        for entry in entries:
            clusterName = entry["cluster"]
            if clusterName not in clusterWordCount:
                clusterWordCount[clusterName] = {}
            
            desc = entry["desc"]
            
            # NOTE: we keep capitalization and punctuation within a word
            words = desc.split()

            for word in words:
                if word not in clusterWordCount[clusterName]:
                    clusterWordCount[clusterName][word] = 0
                clusterWordCount[clusterName][word] += 1

        topWords = {}
        for clusterName, counts in clusterWordCount.items():
            counts = [[-count, word] for word, count in counts.items()]
            counts = sorted(counts)[:self.numTopWords]
            words = [word for _, word in counts]
            topWords[clusterName] = words

        return topWords

    def run(self):
        topWords = self.getTopWords()
        j = {
            "entries": self.entries,
            "topWords": topWords
        }
        return j



if __name__ == "__main__":
    numTopWords = int(sys.argv[1])
    entries = json.loads(sys.stdin.read())

    gcw = GetTopWords(entries, numTopWords)
    j = gcw.run()
    print(json.dumps(j, sort_keys=True, indent=4))


